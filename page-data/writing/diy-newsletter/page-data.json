{"componentChunkName":"component---src-templates-blog-post-js","path":"/writing/diy-newsletter/","result":{"data":{"site":{"siteMetadata":{"title":"andrewlb"}},"markdownRemark":{"id":"d3a44d66-cf97-5b88-969d-c569575d38c3","excerpt":"I wanted to share a bit about how I made Diverge Weekly, which has been an absolute joy to create and just hit 200 subscribers (you should join, by the way…","html":"<p>I wanted to share a bit about how I made <a href=\"https://divergeweekly.com\">Diverge Weekly</a>, which has been an absolute joy to create and just hit 200 subscribers (you should join, by the way).</p>\n<p>Shortly before the world descended into a pandemic, I had an idea for something I wanted to write. Last year, my friends Zahra, Marc, and I had been batting around the idea for a podcast (as one does) about design, strategy, and politics from a Canadian lens, but we were never able to coordinate between ourselves to get it together.</p>\n<p>For the past few months, I’d been taking out some advertising with a newsletter called <a href=\"https://densediscovery.com\">Dense Discovery</a>, which had been started by designer and editor Kai Brach. It was thoughtfully arranged, had a good pace, was opinionated, and helped me discover some things that didn’t normally have time to deal with. So using that structure as a template, I wrote my first newsletter as a prototype — a simple structure in markdown.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 293.96709323583184%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"markdown\"\n        title=\"markdown\"\n        src=\"/static/cb174aad73b43f92937b317a5fadcd1e/799d3/markdown.png\"\n        srcset=\"/static/cb174aad73b43f92937b317a5fadcd1e/00d96/markdown.png 148w,\n/static/cb174aad73b43f92937b317a5fadcd1e/0b23c/markdown.png 295w,\n/static/cb174aad73b43f92937b317a5fadcd1e/799d3/markdown.png 590w,\n/static/cb174aad73b43f92937b317a5fadcd1e/2a3d6/markdown.png 885w,\n/static/cb174aad73b43f92937b317a5fadcd1e/4a421/markdown.png 1094w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>I love Markdown. It has its faults, but I find it faster and more intuitive than any word processor. I’m writing this in markdown using Bear right now, and will be uploading it as a markdown file to be compiled by Gatsby, after all.</p>\n<p>And I took the same approach with Diverge. Early in the year on <a href=\"https://andrewlb.com\">andrewlb.com</a>, I had upgrade my site from a simple Jekyll site to a gatsbyjs page, following their general tutorial for creating a blog and throwing in some modifications in the process. The workflow made a lot of sense to me, especially the part about Gatsby generating a static site and hosting it on GitHub pages. And since newsletters are just HTML, I figured the same workflow might apply there. It shouldn’t take a whole lot to take the same principle and apply it to a newsletter, right?</p>\n<h2>DIYing a Newsletter Platform</h2>\n<p>Turns out it was more complicated than I thought. To begin with, I was starting with an advantage. As part of the privacy-first principle with <a href=\"https://knowsi.com\">Knowsi</a> (and a desire to reduce dependencies on 3rd party services, I self-host a newsletter system called <a href=\"https://sendy.co\">Sendy</a>. Sendy is a PHP application that lets you manage newsletters. It does it pretty simply, though it certainly isn’t as full featured as something like Mailchimp. It has all the annoying bits of running your own infrastructure (eg. Keeping it updated), but I’ve enjoyed this approach.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.55140186915888%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB60lEQVQoz21T22rbQBDV//9DKbS0EGhfSinkoU1LMSFNndQPgUKM7di6rLQ3XW1pZel0Zusa43RgmWVGe2bOmVHwOF9gcn2D6d0MP6e/kOcFhBCI4xi73Q5s4zge/en5Z6ex4Nv3CV68fI1Xby7w9uI9pFLIsgxhGMIYg2EYngGcgvg7TgCd69C17fHD3vUw2sDmuQcsy/Lw6P8den9SKyiKwnfEANxNta0Ry8Tfcai83+//Fut7aK1RVSXJsT2CuN5hJZ5Q1zUCRRTn8zlRlT65qSJcLSfYrCI8bTYIowSL5QpFWaHtCNDk6IjFeh2iqGqMVFdtc7xbfMRyvUbQNA2stRg4Q5Y2ErPsAVoaZFRMEf0sk8iLEj11uiN59sPota7pLVvpanyJJz7mKUsp0R50jBuB6+gWaUSTTmIvRxRFnqpzDqw5yyFEAmMNXNvBbC0+rC+RUCxgXZh73dTAfkS6k5iKGayy1J3yg+GCVVV5LR3RZUCOG2JmlIaqNS6jKyijEeDM0lbhNrlHlmS+IoPxXnJRBuy6znvunHWXKZ1KEeBXiFQgOF8D7vAmvoMSEmmWgod2DsgdMiDntNTISolP4WcI+v4ZoO1y/NaPKGiaPKz8sI/sGYwlYkDOsf4F/Vm2yfFD3tPqWfwB4vtGQpmNk4wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sendy\"\n        title=\"sendy\"\n        src=\"/static/fa539759c3dbbc56010fd75c666775ec/799d3/sendy.png\"\n        srcset=\"/static/fa539759c3dbbc56010fd75c666775ec/00d96/sendy.png 148w,\n/static/fa539759c3dbbc56010fd75c666775ec/0b23c/sendy.png 295w,\n/static/fa539759c3dbbc56010fd75c666775ec/799d3/sendy.png 590w,\n/static/fa539759c3dbbc56010fd75c666775ec/2a3d6/sendy.png 885w,\n/static/fa539759c3dbbc56010fd75c666775ec/ae92f/sendy.png 1180w,\n/static/fa539759c3dbbc56010fd75c666775ec/e48dc/sendy.png 2140w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>So I had that part in place. But what about actually making the newsletter.</p>\n<p>Well, upon deeper inspection, turns out newsletter HTML in a “cross-browser” sense is even more of a nightmare than getting browser-based compliance. I did some digging around, and again found Kai’s <a href=\"https://medium.com/@kaibrach/creating-a-fully-customised-weekly-newsletter-b7c31d580b4e\">look behind Dense Discovery</a> to be helpful here in deciding on what path to take. But I ended up taking the slightly harder one.</p>\n<p>I started by forking andrewlb.com, and starting from that as a baseline. I was familiar with the codebase, so it let me get started pretty quickly.</p>\n<p>I knew that I wanted a few things:</p>\n<ol>\n<li>Everything must be component based</li>\n<li>Everything should be responsive</li>\n<li>I should write the newsletter only once</li>\n</ol>\n<p>So, overall a few decisions were easy to make.</p>\n<p>Since it’s Gatsby, using react components for layout was an obvious choice. That addressed the component based structure.</p>\n<p>Because I was writing in Markdown, I could leverage Remark and the static rendering of that markdown onto the page. This also meant I could explore different Remark and Gatsby plugins to facilitate rendering.</p>\n<p>Because I was using Gatsby, I figured I could override part of its rendering lifecycle and simply compile the same “page” is a few different ways.</p>\n<p>And finally on the responsive front, I thought this would be easy, but as Kai’s article pointed out, turns out email HTML is a bit harder than I initially realized.</p>\n<p>So let’s take each of these in turn.</p>\n<h2>Make it Component Based</h2>\n<p>I’ve been using React for a while now, so know it pretty well. The JSX and component based structure, as well as the r eact component lifecycle in a server-side rendering context is pretty familiar.</p>\n<p>I am also a <em>huge</em> fan of styled components, though readily acknowledge the arguments against them. So a lot of decisions were less decisions and more defaults.</p>\n<p>When it came to structuring the components though, it was a bit less clear. I initially thought I’d use MJML, for example. ’ve used MJML before to write the Knowsi newsletter, and have a template that kind of works for that. I had an idea that perhaps I could lay out react components using MJML syntax. But it turned out to be a bit more complicated than it was really worth. The MJML syntax described on the component level ended up being a bit of nightmare when it came to rendering the page out, and so I pretty quickly abandoned that approach in favor of simply laying out components using HTML tables.</p>\n<p>There were also numerous components that I had to over-ride in the Gatsby process, including the <code class=\"language-text\">html.js</code> one. Normally this is managed pretty simply, but html emails require a handful of headers that help with renderin. <a href=\"https://webdesign.tutsplus.com/articles/build-an-html-email-template-from-scratch--webdesign-12770\">This was a helpful reference</a>.</p>\n<p>Finally, I had to figure out how to get the components to render the markdown appropriately.</p>\n<p>This came from me kind of misunderstanding how Remark worked, to be perfectly honest. That misunderstanding resolved itself pretty quickly after I dug into it though.</p>\n<p>I initially ended up using a plugin called <code class=\"language-text\">gatsby-remark-custom-blocks</code>, which took blocks of text like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\">[[region | Europe]]\n|<span class=\"token url\">[<span class=\"token content\">World War II and the battle over collective memory in Eastern Europe</span>](https://www.dw.com/en/world-war-ii-and-the-battle-over-collective-memory-in-eastern-europe/a-53356626)</span>\n|On the topic of lenses, I found this article to be pretty interesting. Putin is a leader with a strong sense of national history, and his resonance towards World War II as a moment of national pride and unbelievable trauma for Russians makes for an interesting analysis.</code></pre></div>\n<p>And wrapped those in a stylable div. I still use them in the region section, to look like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.48375451263538%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7ElEQVQoz51TW2sTQRTOL/ZNEB/EGxZEQfGhFBGkVhRNk6aiVaTqo7cXpd3uLtn7NdlNAhvIpWb38zsDm7X1rQOHmXPON99858xMSzs5get5MAwDcZJARlmWKKuqmf+1svovVtFkyNz68e0rjn7/wufDQ/RNExcdNWnLznKI9dMBnNEIehxDC0KYaYpjz4cWhjCo3EhSFT9yPRz7PpzxBP50Cr+Y4g8rWSu8tLmFay9e4srTbdxsd3B1e4f2DDde7+Ly4ydqfbvbw8abt7i121XY66/a2Pr+EztmH891E8Vy2RDeIeh+bx+bn77g4cF7bBD84N0BHn34iHuM3+100bUc9Fwfe7R9P1TW6dtok3DPsjE9PW0IXcqPWJ7lOAhZmiPl0PLxGA4vy2aJQRSpvGBjYiVuWhbmy4YIcjnSQ891YTMZc1PADQl7OBwOYTEWsX9hECCjLzjxfZJJLCZOYi4PWq1WjUJN0xCRzLZtBAT6opAg8WU2efMeYzKLr+u6wgu2KArMZrOzz0YIQp48GAwUmZwsvmxIWV7CNrhUUh8mOSGU9Xw+XxOtn43HEiSZZZlSJet6Q01SYyQ/4tMas7+TyQSLxeLMG1QK5URRlee5IhClsklMiGv1olTyNcn5B12P1kV/RXXuy9XjL5EpdEabtWncAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"europe\"\n        title=\"europe\"\n        src=\"/static/58a0d439330c8905ed2d9eb3eb01a4dd/799d3/europe.png\"\n        srcset=\"/static/58a0d439330c8905ed2d9eb3eb01a4dd/00d96/europe.png 148w,\n/static/58a0d439330c8905ed2d9eb3eb01a4dd/0b23c/europe.png 295w,\n/static/58a0d439330c8905ed2d9eb3eb01a4dd/799d3/europe.png 590w,\n/static/58a0d439330c8905ed2d9eb3eb01a4dd/2a3d6/europe.png 885w,\n/static/58a0d439330c8905ed2d9eb3eb01a4dd/124cd/europe.png 1108w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>This wasn’t really helpful for most of the things I wanted to lay out though, and it didn’t let my apply react component-level styling to those elements. Really, I was hoping to pass the markdown content into those components as props, and have it render appropriately.</p>\n<p>The solution ended up being to use a tool called <a href=\"https://github.com/rehypejs/rehype\">Rehype</a>. I simply wrote the different components with their appropriate props, and added this code to the post structure.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> rehypeReact <span class=\"token keyword\">from</span> <span class=\"token string\">\"rehype-react\"</span>\n\n<span class=\"token keyword\">const</span> renderAst <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">rehypeReact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  createElement<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span>createElement<span class=\"token punctuation\">,</span>\n  components<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// These are some of the components I'm using</span>\n    region<span class=\"token punctuation\">:</span> Region<span class=\"token punctuation\">,</span>\n    sponsor<span class=\"token punctuation\">:</span> FeatureAd<span class=\"token punctuation\">,</span>\n    security<span class=\"token punctuation\">:</span> Security<span class=\"token punctuation\">,</span>\n    voices<span class=\"token punctuation\">:</span> Voices<span class=\"token punctuation\">,</span>\n    reading<span class=\"token punctuation\">:</span> Reading<span class=\"token punctuation\">,</span>\n    main<span class=\"token punctuation\">:</span> Main<span class=\"token punctuation\">,</span>\n    twitter<span class=\"token punctuation\">:</span> Twitter<span class=\"token punctuation\">,</span>\n    imageblock<span class=\"token punctuation\">:</span> ImageBlock<span class=\"token punctuation\">,</span>\n    classified<span class=\"token punctuation\">:</span> Classified<span class=\"token punctuation\">,</span>\n    jobs<span class=\"token punctuation\">:</span> Jobs<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Compiler</code></pre></div>\n<p>Then, where the markdown data is transformed by Remark, I added</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{renderAst(post.htmlAst)}</code></pre></div>\n<p>And made sure that the graphql interface was returning the appropriate field:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">markdownRemark</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fields<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> slug<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> eq<span class=\"token punctuation\">:</span> $slug <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      id\n      <span class=\"token function\">excerpt</span><span class=\"token punctuation\">(</span>pruneLength<span class=\"token punctuation\">:</span> <span class=\"token number\">160</span><span class=\"token punctuation\">)</span>\n      htmlAst\n      fields <span class=\"token punctuation\">{</span>\n        slug\n      <span class=\"token operator\">...</span>\n      <span class=\"token punctuation\">}</span>\n\t<span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This allowed me to structure the layout of the site as react components and simply pass in key values as props. <a href=\"https://divergeweekly.com/issue/10/\">An example from issue #10</a> is the component housing the main block.</p>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span>\n  <span class=\"token attr-name\">credit</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Kunrong Chen, Daily exercise, 2014<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">quote</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>It occurred to me that no matter where I lived, geography could not save me. —  Isabel Wilkerson, The Warmth of Other Suns <span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">></span></span>\n  <span class=\"token url\">![<span class=\"token content\">Kunrong Chen, Daily exercise, 2014</span>](img/SFS2-EF.jpg)</span> Hi. First, I want to\n  share a point of gratitude. My small business, <span class=\"token url\">[<span class=\"token content\">Knowsi</span>](https://knowsi.com)</span>,\n  was awarded the <span class=\"token url\">[<span class=\"token content\">Sage Ocean Concept\n  Grant</span>](https://ocean.sagepub.com/blog/tools-and-tech/concept-grant-winner-knowsi-interview)</span>\n  this week by Sage Publishing. ... As always, <span class=\"token url\">[<span class=\"token content\">please subscribe to and share\n  Diverge Weekly</span>](https://divergeweekly.com)</span> if you haven’t and <span class=\"token url\">[<span class=\"token content\">send me a\n  note</span>](mailto:alb@andrewlb.com)</span> if you have questions or feedback!\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This has some weird bits, but it’s working pretty well so far provided I want to stick with markdown.</p>\n<p>In terms of general workflow then, I usually write the main article in Bear, export to markdown into the Gatsby content folder, and do a quick copy-paste to this template I’ve created:</p>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token hr punctuation\">---</span>\ntitle: The First Reflection Issue\nissue: 5\ndate: \"2020-04-08T09:00:00.000Z\"\ndescription: \"This is issue #5, so I figured it was time for a short reflection\"\ncategory: issue\npublished: false\nimage: img/__________.png\ntags:\n  <span class=\"token list punctuation\">-</span> newsletter\n  <span class=\"token list punctuation\">-</span> \"2020\"\n  <span class=\"token title important\">- reflection\n<span class=\"token punctuation\">---</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>main</span> <span class=\"token attr-name\">credit</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">quote</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  ![](img/) Hi. As always, <span class=\"token url\">[<span class=\"token content\">please subscribe to and share Diverge\n  Weekly</span>](https://divergeweekly.com)</span> if you haven’t and <span class=\"token url\">[<span class=\"token content\">send me a\n  note</span>](mailto:alb@andrewlb.com)</span> if you have questions or feedback!\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>main</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>voices</span> <span class=\"token attr-name\">who</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span> <span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span> <span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">image</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>img/ <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token url\">![<span class=\"token content\"> </span>](img/)</span> fdsdfsdf [ ]()\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>voices</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>twitter</span> <span class=\"token attr-name\">who</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  [ ]()\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>twitter</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>region</span><span class=\"token punctuation\">></span></span>\n  [[region | East Asia]] |[]() | [[region | South Asia]] |[]() | [[region |\n  Americas]] |[]() | [[region | MENA]] |[]() | [[region | Africa]] |[]() |\n  [[region | Europe]] |[]() |\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>region</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>reading</span> <span class=\"token attr-name\">title</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span> <span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">author</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span> <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token url\">![<span class=\"token content\"> </span>](img/)</span> fdsdfsdf [ ]()\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>reading</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>security</span> <span class=\"token attr-name\">credit</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token url\">![<span class=\"token content\">Source: </span>](img/)</span> []() sdfsdf\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>security</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>jobs</span><span class=\"token punctuation\">></span></span>\n  [[jobad | ]] |[]() |Located in | | [[jobad | ]] |[]() |Located in | |\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>jobs</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>sponsor</span> <span class=\"token attr-name\">image</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://www.knowsi.com/static/tier1.png<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token title important\"><span class=\"token punctuation\">##</span> Knowsi Knowsi manages consent for user research. Send and track participant</span>\n  consent with custom forms and GDPR-focused tools. <span class=\"token url\">[<span class=\"token content\">Join Knowsi today for\n  free!</span>](https://knowsi.com)</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>sponsor</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image</span> <span class=\"token attr-name\">credit</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span> <span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">link</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span> <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token url\">![<span class=\"token content\"> </span>](img/)</span> sdfsdf\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>image</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Then simply double check that things look right on development, turn <code class=\"language-text\">published</code> to true, and deploy to <code class=\"language-text\">gh-pages</code>.</p>\n<h2>Everything Should Be Responsive</h2>\n<p>This turned into a massive pain.</p>\n<p>The initial site came together in about 3 days of pretty frantic work in February.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 346px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.72254335260115%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/0lEQVQ4y62TPW/TUBSG/UeYmUBsrBETjEgICXYmxMSCWJAYGBAqqAS6QCvoggoS3ZAqPiISQoqaJoWmSZo0oVX6EZq6aYib2Pfj4Tp2mzAgkcKVrn3fY/vRec85tjSgtX8N1oH2Q8F9uG0RwnR7B1VJgVID6OGXJYWHNAdRiCFGziC7DlJppBBIKYfellayR1blBOLhObTXHbB9FMuDwNGzaNENHR/Rsp+h/6kqxQ+B/yVDXUn2gPxrhlIKXAHuwkwPeNgUGTZlyOZYPjV3N0rmfAQmLqC6+6FlFdgIkw20+gvLZs1fv0Xy9HF4dhHd+RkQ/FKYmdSdFki37ymgh89lX4cl6gGzN++QipyCycu/jbPebyKeXEI7dqBd548jf9DIHvDL1RskTh6DaAQRG0N8iCIL79Hri3i3TyBm7uG9uIacvILa20I1N5GZadTcVKAb3838dvoZbs3EKD8agdlx1LsHEBuFzxPI9Ct06jl8fAzxMWTiqanPS1h4DalxxNv75jxtYlPQbuD/tFZje5tkOs2b+CcajqDeFsTnl8gWq7S6io1dh9TXoonlaJuSrdTqzGYXSWZy+JXNlarMfSuwXF7B81ysVqvFcsEE8nlaTZu93R2K+RzrtTU6Thu78cPoJUrFPG7Hob65Yc7mfaOF26W2tspqtYJt272x+QV+cW4MQjJdQgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"commits\"\n        title=\"commits\"\n        src=\"/static/c04a4dfbc24fb948c43809545d9cf487/e8c3d/commits.png\"\n        srcset=\"/static/c04a4dfbc24fb948c43809545d9cf487/00d96/commits.png 148w,\n/static/c04a4dfbc24fb948c43809545d9cf487/0b23c/commits.png 295w,\n/static/c04a4dfbc24fb948c43809545d9cf487/e8c3d/commits.png 346w\"\n        sizes=\"(max-width: 346px) 100vw, 346px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>And it didn’t really look that great. I was borrowing the initial layout from <a href=\"https://www.densediscovery.com/\">Dense Discovery</a>, and hadn’t really figured out the Rehype part yet. So I was trying to lay things out primarily with CSS, and mostly just get something up to see if it worked. I default (to a fault) towards spin up prototypes, put in front of people, see what happens.</p>\n<p>There’s not much I can say here that hasn’t already been written by more knowledgeable folk. I would suggest checking this out as a starting point for html emails:</p>\n<p><a href=\"https://www.smashingmagazine.com/2017/01/introduction-building-sending-html-email-for-web-developers/\">An Introduction To Building And Sending HTML Email For Web Developers — Smashing Magazine</a></p>\n<p>And for the blog itself, make sure to test that SEO and open graph data is being hydrated properly:</p>\n<p><a href=\"https://socialsharepreview.com/\">Social Share Preview – Check social media link previews</a></p>\n<p>I’d actually messed something up in the way that remark was rendering things, and as a consequence the first month of the newsletter didn’t render properly. After I changed that, I started getting a lot more clicks and folk contacting me about my writing.</p>\n<h2>Write it Once</h2>\n<p>Finally, I just wanted to write this once, so that the Gatsby page itself should render at the same time as the mail page, and everything should be easy.</p>\n<p>I tried a bunchhhh of different things, and ultimately resolved on just taking the rendered HTML as it was, and transforming THAT into the mail html. The ideal would be that I’d render two different, properly formatted versions, but I couldn’t quite figure out where to do those modifications, so this became the easy point of intervention.</p>\n<p>Here’s the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onPostBuild</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n    “Build Complete <span class=\"token keyword\">for</span> Post Build”<span class=\"token punctuation\">,</span>\n    path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> “<span class=\"token keyword\">public</span><span class=\"token operator\">/</span>mail<span class=\"token operator\">/</span>“<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> pattern <span class=\"token operator\">=</span> “<span class=\"token keyword\">public</span><span class=\"token operator\">/</span>mail_<span class=\"token operator\">*</span><span class=\"token comment\">/**/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>html”\n  <span class=\"token keyword\">const</span> files <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">globAsync</span><span class=\"token punctuation\">(</span>pattern<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> nodir<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> inlined <span class=\"token operator\">=</span> files<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">file</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">readFileAsync</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> “utf8”<span class=\"token punctuation\">)</span></code></pre></div>\n<p>First, I grab all the files in the mail folder which were rendered with CreatePage, and loop through them.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> html <span class=\"token operator\">=</span> <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> “https<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>divergeweekly<span class=\"token punctuation\">.</span>com”\n\n      <span class=\"token keyword\">const</span> $ <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span>\n\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>“script”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// remove scripts</span>\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>“noscript”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// remove scripts</span>\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>“link”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// remove links</span></code></pre></div>\n<p>Then I remove the tags that aren’t going to be used. Links, script, and noscript. I never use jquery anymore, but for whatever reason it was a helpful default here, so I ended up relying on Cheerio just for simplicity sake.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>“img<span class=\"token punctuation\">[</span>src<span class=\"token operator\">^=</span>‘<span class=\"token operator\">/</span>‘<span class=\"token punctuation\">]</span>”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">prop</span><span class=\"token punctuation\">(</span>“href”<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">_idx<span class=\"token punctuation\">,</span> oldHref</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>oldHref<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>“Something is weird”<span class=\"token punctuation\">,</span> oldHref<span class=\"token punctuation\">,</span> _idx<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> oldHref<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// Convert Gatsby image to image</span>\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>“<span class=\"token punctuation\">.</span>gatsby<span class=\"token operator\">-</span>resp<span class=\"token operator\">-</span>image<span class=\"token operator\">-</span>wrapper”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> _this <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceWith</span><span class=\"token punctuation\">(</span>\n          <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;img src=“</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url <span class=\"token operator\">+</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>“img”<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span>“src”<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">” alt=“</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>“img”<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span>“alt”<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">” /></span><span class=\"token template-punctuation string\">`</span></span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// Convert picture</span>\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>“picture”<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> _this <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replaceWith</span><span class=\"token punctuation\">(</span>\n          <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;img src=“</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url <span class=\"token operator\">+</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>“img”<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span>“src”<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">” alt=“</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span>“img”<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span>“alt”<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">” /></span><span class=\"token template-punctuation string\">`</span></span>\n        <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I think went through and converted all the images to absolute links and removed the Gatsby responsive images. I wasn’t able to figure out how NOT to use Gatsby images while still leveraging the Sharp plugin for optimizing the image rendering, so this became my shortcut. It’s not the cleanest, but it works pretty well.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">      <span class=\"token comment\">// Convert all links</span>\n      <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>“a”<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">not</span><span class=\"token punctuation\">(</span>‘<span class=\"token punctuation\">[</span>href<span class=\"token operator\">^=</span>“http”<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>href<span class=\"token operator\">^=</span>“https”<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>href<span class=\"token operator\">^=</span>“mailto<span class=\"token punctuation\">:</span>”<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>href<span class=\"token operator\">^=</span>“#\"<span class=\"token punctuation\">]</span>'<span class=\"token punctuation\">)</span>’<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">,</span>”<span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">index<span class=\"token punctuation\">,</span> value</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> \"<span class=\"token operator\">/</span>“<span class=\"token punctuation\">)</span>“<span class=\"token punctuation\">{</span>\n                value <span class=\"token operator\">=</span> url <span class=\"token operator\">+</span> value\n              <span class=\"token punctuation\">}</span>\n\n              <span class=\"token keyword\">return</span> url <span class=\"token operator\">+</span> value\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n              console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>“Weird<span class=\"token punctuation\">.</span>”<span class=\"token punctuation\">,</span>”index<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I think convert all the links to absolute instead of relative values.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> htmlToText<span class=\"token punctuation\">.</span><span class=\"token function\">fromString</span><span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  wordwrap<span class=\"token punctuation\">:</span> <span class=\"token number\">130</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> inlined <span class=\"token operator\">=</span> <span class=\"token function\">juice</span><span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then I render a compile the rendered html into a text format as well for raw-text newsletter rendering, as well as inlining all of the css.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">      <span class=\"token comment\">// Write HTML</span>\n      fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> inlined<span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Inline CSS error on write file:\\n\\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// Write Text</span>\n      fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">\".txt\"</span><span class=\"token punctuation\">,</span> text<span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Inline CSS error on write file:\\n\\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>inlined<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Finally, I write the converted and inlined file back to disc, and also add a text file to be used in the newsletter.</p>\n<p>All and all, this isn’t the cleanest way to approach it, but it works pretty well.</p>\n<p>Last but not least, I write everything to the mail server and create a new campaign using the <a href=\"https://sendy.co/api\">Sendy API</a>.</p>\n<p>I don’t actually have this implemented, but it would look something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"url+\"</span><span class=\"token operator\">/</span>api<span class=\"token operator\">/</span>campaigns<span class=\"token operator\">/</span>create<span class=\"token punctuation\">.</span>php\"<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    method<span class=\"token punctuation\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n    mode<span class=\"token punctuation\">:</span> <span class=\"token string\">\"no-cors\"</span><span class=\"token punctuation\">,</span>\n    credentials<span class=\"token punctuation\">:</span> <span class=\"token string\">\"same-origin\"</span><span class=\"token punctuation\">,</span>\n    headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"Content-Type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"application/x-www-form-urlencoded\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    body<span class=\"token punctuation\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URLSearchParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\tplaintext<span class=\"token punctuation\">:</span> text<span class=\"token punctuation\">,</span>\n\t\thtml<span class=\"token punctuation\">:</span> inlined<span class=\"token punctuation\">,</span>\n\t\ttitle<span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span>\n\t\tfrom_name<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span>from<span class=\"token punctuation\">,</span>\n\t\tfrom_email<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">,</span>\n\t\treply_to<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span>replyto<span class=\"token punctuation\">,</span>\n      list<span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span>listid<span class=\"token punctuation\">,</span>\n      boolean<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      subform<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Reflecting</h2>\n<p>So. Overall, this has been a fun way to learn the details of how Gatsby works, and certainly reflected my workflow. Also, development time aside, the bulk of the TIME spent on the newsletter is content focused, which is exactly what I wanted.</p>\n<p>I love that the newsletters are their own discrete markdown product, stored as files and folder structures, and just clean.</p>\n<p>However, there’s been a few weak points.</p>\n<p>First, I want to create more of a database style approach to the voices, as my hope is to (over time) curate a list of incredible global designers who deserve a stronger voice. Those voices shouldn’t be confined only to that particular newsletter, so I need to figure out a way to address that part.</p>\n<p>Second, the jobs have been a big point of value for folk, and having a more consistent job board for global design roles is something I’d like to emphasize. Likewise, that needs a CMS or board, not just a newsletter.</p>\n<p>Third, the essays interconnect conceptually such that I’d like to explore different approaches to linking and referencing, even within a series. So far I’m just linking to things, but there might be a better way to approach that.</p>\n<p>Finally, the production part of this newsletter is confined to my computer, and so I rely on copying things over to Gatsby and that 15 or so minutes of getting everything compiled and rendering properly.</p>\n<p>So, all told, I actually think in the future I may re-write the Diverge site and workflow to support a headless CMS as my platform, as a relational database of some sort seems to be the next step. I’m likely to go with something like Strapi or Netlify’s CMS, but haven’t really decided yet.</p>\n<p>In the interim though, I’ll be writing Diverge each week somewhere in my beloved markdown editor, trying to figure out how I get everything together before Wednesday.</p>\n<p>Finally, one quick note. HUGE thank you to <a href=\"https://twitter.com/scottalyoung\">Scott Young</a> for helping me find my voice by reading and critiquing the early posts, <a href=\"https://www.brizk.com/\">Kai Brach</a> for inspiration and advice, <a href=\"http://www.aylanewhousedesign.com/\">Ayla Newhouse</a> for absolutely everything including holding onto the baby while I frantically try to finish the newsletter, <a href=\"http://hillarypredko.com/\">Hilary Predko</a> for feedback and sharing Diverge on her newsletter, <a href=\"http://www.runcomrade.ca/\">Janice Wong</a> for unsubscribing with some feedback that dramatically changed my writing style, and <a href=\"https://twitter.com/zahraeb\">Zahra Ebrahim</a> for the constant support!</p>\n<p>Thanks for reading (and <a href=\"https://divergeweekly.com\">subscribe to diverge</a>)!</p>","fields":{"slug":"/diy-newsletter/","readingTime":{"minutes":13.9,"words":2780}},"frontmatter":{"title":"Building a Newsletter from Scratch","date":"May 21, 2020","description":"In February, I got the bright idea to start a newsletter. Instead of going with the normal options, I decided to make things as difficult as possible for myself.","tags":["writing","reflection","diverge","newsletter"],"category":"writing"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/diy-newsletter/","previous":{"id":"b48b4df0-d076-51d5-8baa-41a070cae0ad","fields":{"slug":"/anxietygame/"},"frontmatter":{"title":"Covid Anxiety the Game","category":"writing","tags":["security","writing","coronavirus","design"]}},"next":null}}}